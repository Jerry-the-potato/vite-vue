(function(){"use strict";let p={painter:void 0,pSystem:void 0};self.onmessage=function(a){let c=a.data.w,i=a.data.h;switch(a.data.name){case"transferControlToOffscreen":l=a.data.canvas,w=l.getContext("2d"),y.setPixel(l.width,l.height),L(),q(),A();break;case"setOffscreen":l.width=c,l.height=i,w.translate(c*.25,0),y.setPixel(c,i);break;case"cancelAnimation":cancelAnimationFrame(p.painter),cancelAnimationFrame(p.pSystem),delete p.painter,delete p.pSystem;break;case"requestAnimation":p.painter?self.postMessage({name:"error",message:"requestAnimation existed"}):p.painter=requestAnimationFrame(A),p.pSystem?self.postMessage({name:"error",message:"requestAnimation existed"}):p.pSystem=requestAnimationFrame(q)}};let l,w,y=new Y;function Y(){this.works=[],this.pixelX=100,this.pixelY=100,this.setPixel=function(s,a){this.pixelX=s,this.pixelY=a},this.draw=function(s){let a=s.ctx;this.pixelX,this.pixelY;let c=s.x,i=s.y,e=s.r,t=s.x2,r=s.y2,f=s.text,o=s.size,h=s.color,n=s.a,x=s.b,d=s.angle;if(a)switch(s.name){case"circle":g();break;case"point":u();break;case"line":m();break;case"crescent":S();break;case"text":v()}function g(){if(c+i+e=="NaN"){console.warn("drawCircle failed: missing parameter");return}a.beginPath(),a.arc(c,i,e,0,2*Math.PI,!1),a.fillStyle=h,a.fill()}function u(){if(c+i+o=="NaN"){console.warn("drawPoint failed: missing parameter");return}a.fillStyle=h,a.fillRect(c-o/2,i-o/2,o,o)}function m(){if(c+i+t+r=="NaN"){console.warn("drawLine failed: missing parameter");return}a.beginPath(),a.moveTo(c,i),a.lineTo(t,r),a.strokeStyle=h,a.lineWidth=o||1,a.stroke()}function S(){if(c+i+n+x+d+o=="NaN"){console.warn("drawCrescent failed: missing parameter");return}let z=Math.sqrt(n*n+x*x),k=Math.atan(n/x),B=Math.cos(d+Math.PI/2)*n*o,G=Math.sin(d+Math.PI/2)*n*o;a.beginPath(),a.arc(c,i,x*o,d,Math.PI+d,!0),a.arc(c+B,i+G,z*o,Math.PI+d+k,d-k,!1),a.fillStyle=h,a.fill()}function v(){c=Math.round(c),i=Math.round(i),a.font=o+"px Comic Sans MS",a.textBaseline="middle",a.textAlign="center",a.fillStyle=h,a.fillText(f,c,i)}}}function A(){l.width=l.width,w.translate(l.width*.25,0),y.works.forEach(s=>{y.draw(s)}),y.works=[],p.painter=requestAnimationFrame(A)}let b=0,F=Math.PI/1e4,P=[],N=.5,X=1,D=.5,T=1,I=.1,R=10,C=Date.now();const M=new Array(100);M.fill(17);function q(){E(P),O(P),V(),p.pSystem=requestAnimationFrame(q)}function L(){P=[],s(P,2e3);function s(a,c){for(let e=0;e<c;e++){let t=.5,r=1,f=1+Math.pow(t,r),o=Math.pow(i(t,1),r),h=Math.pow(i(0,t),r),n={d:(f-o-h)*l.width,r:i(0,Math.PI*2),fakeX:l.width/2,fakeY:l.height/2,x:l.width/2,y:l.height/2,vx:[],vy:[]};n.x+=n.d*Math.cos(n.r),n.y+=n.d*Math.sin(n.r),n.fakeX=n.x,n.fakeY=n.y,a.push(n)}function i(e,t){return Math.random()*(t*100-e*100+1)/100+e}}}function E(s){for(let e=0;e<s.length;e++){let t=s[e];const r=b,f=Math.sin(r),o=Math.sin(r*2);let h=t.d/2;h=t.d/3*(.05+.95*(1-o));let n=h*f*.1;t.r+=Math.PI/1e3,t.x-=t.fakeX,t.y-=t.fakeY,t.fakeX=l.width/2+h*Math.cos(t.r+n),t.fakeY=l.height/2+h*Math.sin(t.r+n),t.x+=t.fakeX,t.y+=t.fakeY}for(let e=0;e<s.length;e++){let t=s[e],r=0,f=0,o=0,h=0;for(let x=e+1;x<s.length;x++){let d=s[x],g=a(t.x,t.y,d.x,d.y);const u=0;if(g<u){let m;g<u*.1&&(m=-1),g<u*.55&&(m=1*(g-u*.1)/(u*.45)),g<u&&(m=1*(u-g)/(u*.45)),r+=d.x>t.x?1:-1*m,f+=t.x>d.x?1:-1*m,o+=d.y>t.y?1:-1*m,h+=t.y>d.y?1:-1*m}}t.x+=i(t.vx),t.y+=i(t.vy);const n=100;r+=l.width*.5+n/2>t.x?1:-1*n,r-=l.width*.5-n/2<t.x?1:-1*n,o+=l.height/2+n/2>t.y?1:-1*n,o-=l.height/2-n/2<t.y?1:-1*n,c(t.vx,r),c(t.vy,o)}function a(e,t,r,f){return Math.sqrt(Math.pow(e-r,2)+Math.pow(t-f,2))}function c(e,t){e.splice(1,0,t),e.splice(60,1)}function i(e){let t=0;return e.forEach(r=>{t+=r/e.length/20}),t}}function O(s){for(let i=0;i<s.length;i++){let e=s[i],t=e.x,r=e.y,f=r/l.width*255,o=t/l.width*255,h=Math.sin(b)*255,n="rgb("+Math.abs(h).toString()+","+Math.abs(o).toString()+","+Math.abs(f).toString()+")",x=t/l.width,d=r/l.height,g=a(x,d)*l.width,u=c(x,d)*l.height,m={name:"point",ctx:w,size:2,x:t,y:r,color:n};y.works.push(m);let S={name:"line",ctx:w,size:2,x:t,y:r,x2:t+I*g,y2:r+I*u,color:n};y.works.push(S)}b+=F*R;function a(i,e){return N*i-X*i*e}function c(i,e){return T*i*e-D*e}}function V(){let s=Date.now()-C;C=Date.now(),M.push(s),M.splice(0,1);let a=0,c;for(let k=0;k<M.length;k++)a=a+M[k];c=Math.round(1e3/(a/M.length));let i=Math.PI*(Date.now()%3e3)/1500,e=(l.height+l.width)*.003,t=l.width/2,r=l.height-e*20,f=r/l.width*255,o=t/l.width*255,h=Math.sin(b)*255,n="rgb("+Math.abs(h).toString()+","+Math.abs(o).toString()+","+Math.abs(f).toString()+")",x="rgb("+Math.abs(h*.3).toString()+","+Math.abs(o*.2).toString()+","+Math.abs(f*.4).toString()+")",d={name:"circle",ctx:w,r:e*10,x:t,y:r,color:x},g={name:"crescent",ctx:w,size:e,a:1,b:9,angle:i*3,x:t,y:r,color:n},u={name:"crescent",ctx:w,size:e,a:1,b:8,angle:i*2,x:t,y:r,color:n},m={name:"crescent",ctx:w,size:e,a:1,b:7,angle:i*1,x:t,y:r,color:n},S={name:"text",ctx:w,text:"fps",size:e*4,x:t,y:r-e*3,color:n},v={name:"text",ctx:w,text:c,size:e*4,x:t,y:r+e*3,color:n},z={name:"text",ctx:w,text:"Res: "+Math.round(l.width)+" x "+Math.round(l.height),size:e*4,x:t,y:r+e*13,color:n};y.works.push(d,g,u,m,S,v,z)}})();
